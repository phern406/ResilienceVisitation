"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react");function t(){return(t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}var n=function(t){var n=e.useRef(t);return n.current=t,n},o="ðŸ’¡ use-places-autocomplete: Please provide a place Id when using getDetails() either as a string or as part of an Autocomplete Prediction.";exports.default=function(o){var a,r,s,c=void 0===o?{}:o,u=c.requestOptions,i=c.debounce,l=void 0===i?200:i,d=c.cache,p=void 0===d?86400:d,g=c.googleMaps,f=c.callbackName,m=c.defaultValue,v=void 0===m?"":m,w=c.initOnMount,h=void 0===w||w,y=e.useState(!1),b=y[0],P=y[1],O=e.useState(v),S=O[0],x=O[1],k=e.useState({loading:!1,status:"",data:[]}),C=k[0],A=k[1],I=e.useRef(null),_=n(u),j=n(g),D=e.useCallback((function(){var e;if(!I.current){var t=window.google,n=j.current,o=(null==n?void 0:n.places)||(null==t||null==(e=t.maps)?void 0:e.places);o?(I.current=new o.AutocompleteService,P(!0)):console.error("ðŸ’¡ use-places-autocomplete: Google Maps Places API library must be loaded. See: https://github.com/wellyshen/use-places-autocomplete#load-the-library")}}),[]),G=e.useCallback((function(){A({loading:!1,status:"",data:[]})}),[]),K=e.useCallback((function(){try{sessionStorage.removeItem("upa")}catch(e){}}),[]),M=e.useCallback((a=function(e){if(e){A((function(e){return t({},e,{loading:!0})}));var n={};try{n=JSON.parse(sessionStorage.getItem("upa")||"{}")}catch(e){}p&&(n=Object.keys(n).reduce((function(e,t){return n[t].maxAge-Date.now()>=0&&(e[t]=n[t]),e}),{}))[e]?A({loading:!1,status:"OK",data:n[e].data}):I.current.getPlacePredictions(t({},_.current,{input:e}),(function(t,o){if(A({loading:!1,status:o,data:t||[]}),p&&"OK"===o){n[e]={data:t,maxAge:Date.now()+1e3*p};try{sessionStorage.setItem("upa",JSON.stringify(n))}catch(e){}}}))}else G()},r=l,function(){for(var e=this,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];null!==s&&(clearTimeout(s),s=null),s=setTimeout((function(){return a.apply(e,n)}),r)}),[l,G]),R=e.useCallback((function(e,t){void 0===t&&(t=!0),x(e),I.current&&t&&M(e)}),[M]);return e.useEffect((function(){if(!h)return function(){return null};var e=window.google;return j.current||null!=e&&e.maps||!f?D():window[f]=D,function(){window[f]&&delete window[f]}}),[f,D]),{ready:b,value:S,suggestions:C,setValue:R,clearSuggestions:G,clearCache:K,init:D}},exports.getDetails=function(e){var t=new window.google.maps.places.PlacesService(document.createElement("div"));return e.placeId?new Promise((function(n,o){t.getDetails(e,(function(e,t){"OK"!==t&&o(t),n(e)}))})):(console.error(o),Promise.reject(o))},exports.getGeocode=function(e){var t=new window.google.maps.Geocoder;return new Promise((function(n,o){t.geocode(e,(function(t,a){"OK"!==a&&o(a),!e.address&&e.componentRestrictions&&(console.error("ðŸ’¡ use-places-autocomplete: Please provide an address when using getGeocode() with the componentRestrictions."),n(t)),n(t)}))}))},exports.getLatLng=function(e){return new Promise((function(t,n){try{var o=e.geometry.location,a=o.lat,r=o.lng;t({lat:a(),lng:r()})}catch(e){n(e)}}))},exports.getZipCode=function(e,t){return new Promise((function(n,o){try{var a=null;e.address_components.forEach((function(e){var n=e.long_name,o=e.short_name;e.types.includes("postal_code")&&(a=t?o:n)})),n(a)}catch(e){o(e)}}))};
